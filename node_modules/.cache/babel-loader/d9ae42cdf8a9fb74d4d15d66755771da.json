{"ast":null,"code":"import _classCallCheck from \"/Users/lixiangyin/around-web/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/lixiangyin/around-web/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/lixiangyin/around-web/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/lixiangyin/around-web/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/lixiangyin/around-web/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/lixiangyin/around-web/src/components/Home.js\";\nimport React from 'react';\nimport $ from 'jquery';\nimport { Tabs, Spin, Row, Col, Radio } from 'antd';\nimport { GEO_OPTIONS, POS_KEY, API_ROOT, TOKEN_KEY, AUTH_PREFIX } from '../constants';\nimport { Gallery } from './Gallery';\nimport { CreatePostButton } from './CreatePostButton';\nimport { WrappedAroundMap } from './AroundMap';\nvar RadioGroup = Radio.Group;\nexport var Home =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(Home, _React$Component);\n\n  function Home() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, Home);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(Home)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {\n      loadingGeoLocation: false,\n      loadingPosts: false,\n      posts: [],\n      error: '',\n      topic: 'around'\n    };\n\n    _this.getGeolocation = function () {\n      if (\"geolocation\" in navigator) {\n        navigator.geolocation.getCurrentPosition(_this.onSuccessLoadGeoLocation, _this.onFailedLoadGeoLocation, GEO_OPTIONS);\n      } else {\n        _this.setState({\n          loadingGeoLocation: false,\n          error: 'Your browser does not support geolocation.'\n        });\n      }\n    };\n\n    _this.onSuccessLoadGeoLocation = function (position) {\n      _this.setState({\n        loadingGeoLocation: false,\n        error: ''\n      });\n\n      console.log(position);\n      var _position$coords = position.coords,\n          latitude = _position$coords.latitude,\n          longitude = _position$coords.longitude;\n      localStorage.setItem(POS_KEY, JSON.stringify({\n        lat: latitude,\n        lon: longitude\n      }));\n\n      _this.loadNearbyPost();\n    };\n\n    _this.loadNearbyPost = function (location, radius) {\n      _this.setState({\n        loadingPosts: true,\n        error: ''\n      });\n\n      var _ref = location ? location : JSON.parse(localStorage.getItem(POS_KEY)),\n          lat = _ref.lat,\n          lon = _ref.lon;\n\n      var range = radius ? radius : 20;\n      var token = localStorage.getItem(TOKEN_KEY);\n      var endPoint = _this.state.topic === 'around' ? 'search' : 'cluster';\n      $.ajax({\n        url: \"\".concat(API_ROOT, \"/\").concat(endPoint, \"?lat=\").concat(lat, \"&lon=\").concat(lon, \"&range=\").concat(range, \"&term=\").concat(_this.state.topic),\n        method: 'GET',\n        headers: {\n          Authorization: \"\".concat(AUTH_PREFIX, \" \").concat(token)\n        }\n      }).then(function (response) {\n        var posts = response ? response : [];\n\n        _this.setState({\n          posts: posts,\n          loadingPosts: false,\n          error: ''\n        });\n\n        console.log(response);\n      }, function (response) {\n        console.log(response.responseText);\n\n        _this.setState({\n          loadingPosts: false,\n          error: 'Failed to load posts.'\n        });\n      }).catch(function (e) {\n        console.log(e);\n      });\n    };\n\n    _this.onFailedLoadGeoLocation = function () {\n      console.log('failed to load geo location.');\n\n      _this.setState({\n        loadingGeoLocation: false,\n        error: 'Failed to load geo location.'\n      });\n    };\n\n    _this.getPanelContent = function (type) {\n      if (_this.state.error) {\n        return React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 76\n          },\n          __self: this\n        }, _this.state.error);\n      } else if (_this.state.loadingGeoLocation) {\n        return React.createElement(Spin, {\n          tip: \"Loading geo location...\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 78\n          },\n          __self: this\n        });\n      } else if (_this.state.loadingPosts) {\n        return React.createElement(Spin, {\n          tip: \"Loading posts...\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 80\n          },\n          __self: this\n        });\n      } else if (_this.state.posts) {\n        return type === 'images' ? _this.getImagePosts() : _this.getVideoPosts();\n      } else {\n        return React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 84\n          },\n          __self: this\n        }, \"Nothing found...\");\n      }\n    };\n\n    _this.getImagePosts = function () {\n      var images = _this.state.posts.filter(function (post) {\n        return post.type === 'image';\n      }).map(function (post) {\n        return {\n          user: post.user,\n          src: post.url,\n          thumbnail: post.url,\n          caption: post.message,\n          thumbnailWidth: 400,\n          thumbnailHeight: 300\n        };\n      });\n\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 102\n        },\n        __self: this\n      }, React.createElement(Gallery, {\n        images: images,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 103\n        },\n        __self: this\n      }));\n    };\n\n    _this.getVideoPosts = function () {\n      return React.createElement(Row, {\n        gutter: 32,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 110\n        },\n        __self: this\n      }, _this.state.posts.filter(function (post) {\n        return post.type === 'video';\n      }).map(function (post) {\n        return React.createElement(Col, {\n          span: 6,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 116\n          },\n          __self: this\n        }, React.createElement(\"video\", {\n          src: post.url,\n          key: post.url,\n          controls: true,\n          className: \"video-block\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 117\n          },\n          __self: this\n        }), React.createElement(\"p\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 118\n          },\n          __self: this\n        }, post.user, \": \", post.message));\n      }));\n    };\n\n    _this.onTopicChange = function (e) {\n      _this.setState({\n        topic: e.target.value\n      }, _this.loadNearbyPost);\n    };\n\n    return _this;\n  }\n\n  _createClass(Home, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.setState({\n        loadingGeoLocation: true,\n        error: ''\n      });\n      this.getGeolocation();\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var TabPane = Tabs.TabPane;\n      var operations = React.createElement(CreatePostButton, {\n        loadNearbyPost: this.loadNearbyPost,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 132\n        },\n        __self: this\n      });\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 134\n        },\n        __self: this\n      }, React.createElement(RadioGroup, {\n        className: \"topic-radio-group\",\n        value: this.state.topic,\n        onChange: this.onTopicChange,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 135\n        },\n        __self: this\n      }, React.createElement(Radio, {\n        value: \"around\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 136\n        },\n        __self: this\n      }, \"Posts Around Here\"), React.createElement(Radio, {\n        value: \"face\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 137\n        },\n        __self: this\n      }, \"Faces Around The World\")), React.createElement(Tabs, {\n        tabBarExtraContent: operations,\n        className: \"main-tabs\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 139\n        },\n        __self: this\n      }, React.createElement(TabPane, {\n        tab: \"Image Posts\",\n        key: \"1\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 140\n        },\n        __self: this\n      }, this.getPanelContent('images')), React.createElement(TabPane, {\n        tab: \"Video Posts\",\n        key: \"2\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 143\n        },\n        __self: this\n      }, this.getPanelContent('videos')), React.createElement(TabPane, {\n        tab: \"Map\",\n        key: \"3\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 146\n        },\n        __self: this\n      }, React.createElement(WrappedAroundMap, {\n        googleMapURL: \"https://maps.googleapis.com/maps/api/js?key=AIzaSyD3CEh9DXuyjozqptVB5LA-dN7MxWWkr9s&v=3.exp&libraries=geometry,drawing,places\",\n        loadingElement: React.createElement(\"div\", {\n          style: {\n            height: \"100%\"\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 149\n          },\n          __self: this\n        }),\n        containerElement: React.createElement(\"div\", {\n          style: {\n            height: \"600px\"\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 150\n          },\n          __self: this\n        }),\n        mapElement: React.createElement(\"div\", {\n          style: {\n            height: \"100%\"\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 151\n          },\n          __self: this\n        }),\n        posts: this.state.posts,\n        loadNearbyPost: this.loadNearbyPost,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 147\n        },\n        __self: this\n      }))));\n    }\n  }]);\n\n  return Home;\n}(React.Component);","map":{"version":3,"sources":["/Users/lixiangyin/around-web/src/components/Home.js"],"names":["React","$","Tabs","Spin","Row","Col","Radio","GEO_OPTIONS","POS_KEY","API_ROOT","TOKEN_KEY","AUTH_PREFIX","Gallery","CreatePostButton","WrappedAroundMap","RadioGroup","Group","Home","state","loadingGeoLocation","loadingPosts","posts","error","topic","getGeolocation","navigator","geolocation","getCurrentPosition","onSuccessLoadGeoLocation","onFailedLoadGeoLocation","setState","position","console","log","coords","latitude","longitude","localStorage","setItem","JSON","stringify","lat","lon","loadNearbyPost","location","radius","parse","getItem","range","token","endPoint","ajax","url","method","headers","Authorization","then","response","responseText","catch","e","getPanelContent","type","getImagePosts","getVideoPosts","images","filter","post","map","user","src","thumbnail","caption","message","thumbnailWidth","thumbnailHeight","onTopicChange","target","value","TabPane","operations","height","Component"],"mappings":"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","sourcesContent":["import React from 'react';\nimport $ from 'jquery';\nimport { Tabs, Spin, Row, Col, Radio } from 'antd';\nimport { GEO_OPTIONS, POS_KEY, API_ROOT, TOKEN_KEY, AUTH_PREFIX } from '../constants';\nimport { Gallery } from './Gallery';\nimport { CreatePostButton } from './CreatePostButton';\nimport { WrappedAroundMap } from './AroundMap';\n\nconst RadioGroup = Radio.Group;\n\nexport class Home extends React.Component {\n    state = {\n        loadingGeoLocation: false,\n        loadingPosts: false,\n        posts: [],\n        error: '',\n        topic: 'around',\n    }\n\n    componentDidMount() {\n        this.setState({ loadingGeoLocation: true, error: '' });\n        this.getGeolocation();\n    }\n\n    getGeolocation = () => {\n        if (\"geolocation\" in navigator) {\n            navigator.geolocation.getCurrentPosition(\n                this.onSuccessLoadGeoLocation,\n                this.onFailedLoadGeoLocation,\n                GEO_OPTIONS,\n            );\n        } else {\n            this.setState({ loadingGeoLocation: false, error: 'Your browser does not support geolocation.' });\n        }\n    }\n\n    onSuccessLoadGeoLocation = (position) => {\n        this.setState({ loadingGeoLocation: false, error: '' });\n        console.log(position);\n        const { latitude, longitude } = position.coords;\n        localStorage.setItem(POS_KEY, JSON.stringify({ lat: latitude, lon: longitude }));\n        this.loadNearbyPost();\n    }\n\n    loadNearbyPost= (location, radius) => {\n        this.setState({ loadingPosts: true, error: '' });\n        const { lat, lon } = location? location : JSON.parse(localStorage.getItem(POS_KEY));\n        const range = radius ? radius : 20;\n        const token = localStorage.getItem(TOKEN_KEY);\n        const endPoint = this.state.topic === 'around' ? 'search' : 'cluster';\n        $.ajax({\n            url: `${API_ROOT}/${endPoint}?lat=${lat}&lon=${lon}&range=${range}&term=${this.state.topic}`,\n            method: 'GET',\n            headers: {\n                Authorization: `${AUTH_PREFIX} ${token}`,\n            }\n        }).then((response) => {\n            const posts = response ? response : [];\n            this.setState({ posts, loadingPosts: false, error: '' });\n            console.log(response);\n        }, (response) => {\n            console.log(response.responseText);\n            this.setState({ loadingPosts: false, error: 'Failed to load posts.' });\n        }).catch((e) => {\n            console.log(e);\n        });\n    }\n\n    onFailedLoadGeoLocation = () => {\n        console.log('failed to load geo location.');\n        this.setState({ loadingGeoLocation: false, error: 'Failed to load geo location.' });\n    }\n\n    getPanelContent = (type) => {\n        if (this.state.error) {\n            return <div>{this.state.error}</div>;\n        } else if (this.state.loadingGeoLocation) {\n            return <Spin tip=\"Loading geo location...\"/>;\n        } else if (this.state.loadingPosts) {\n            return <Spin tip=\"Loading posts...\"/>;\n        } else if (this.state.posts) {\n            return type === 'images' ? this.getImagePosts() : this.getVideoPosts();\n        } else {\n            return <div>Nothing found...</div>;\n        }\n    }\n\n    getImagePosts = () => {\n        const images = this.state.posts\n            .filter((post) => post.type === 'image')\n            .map((post) => {\n                return {\n                    user: post.user,\n                    src: post.url,\n                    thumbnail: post.url,\n                    caption: post.message,\n                    thumbnailWidth: 400,\n                    thumbnailHeight: 300,\n                };\n            });\n        return (\n            <div>\n                <Gallery images={images}/>\n            </div>\n        );\n    }\n\n    getVideoPosts = () => {\n        return (\n            <Row gutter={32}>\n                {\n                    this.state.posts\n                        .filter((post) => post.type === 'video')\n                        .map((post) => {\n                            return (\n                                <Col span={6} >\n                                    <video src={post.url} key={post.url} controls className=\"video-block\"/>\n                                    <p>{post.user}: {post.message}</p>\n                                </Col>);\n                        })\n                }\n            </Row>\n        );\n    }\n\n    onTopicChange = (e) => {\n        this.setState({ topic: e.target.value }, this.loadNearbyPost);\n    }\n\n    render() {\n        const TabPane = Tabs.TabPane;\n        const operations = <CreatePostButton loadNearbyPost={this.loadNearbyPost}/>;\n        return (\n            <div>\n                <RadioGroup className=\"topic-radio-group\" value={this.state.topic} onChange={this.onTopicChange}>\n                    <Radio value=\"around\">Posts Around Here</Radio>\n                    <Radio value=\"face\">Faces Around The World</Radio>\n                </RadioGroup>\n                <Tabs tabBarExtraContent={operations} className=\"main-tabs\">\n                    <TabPane tab=\"Image Posts\" key=\"1\">\n                        {this.getPanelContent('images')}\n                    </TabPane>\n                    <TabPane tab=\"Video Posts\" key=\"2\">\n                        {this.getPanelContent('videos')}\n                    </TabPane>\n                    <TabPane tab=\"Map\" key=\"3\">\n                        <WrappedAroundMap\n                            googleMapURL=\"https://maps.googleapis.com/maps/api/js?key=AIzaSyD3CEh9DXuyjozqptVB5LA-dN7MxWWkr9s&v=3.exp&libraries=geometry,drawing,places\"\n                            loadingElement={<div style={{ height: `100%` }} />}\n                            containerElement={<div style={{ height: `600px` }} />}\n                            mapElement={<div style={{ height: `100%` }} />}\n                            posts={this.state.posts}\n                            loadNearbyPost={this.loadNearbyPost}\n                        />\n                    </TabPane>\n                </Tabs>\n            </div>\n        );\n    }\n}\n"]},"metadata":{},"sourceType":"module"}